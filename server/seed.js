require('dotenv').config();
const mongoose = require('mongoose');
const { MongoMemoryServer } = require('mongodb-memory-server');
const Problem = require('./src/models/Problem');
const User = require('./src/models/User');

let mongoServer;

const seedData = async () => {
    try {
        // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ in-memory –ë–î
        console.log('üå± Starting database seed...');
        mongoServer = await MongoMemoryServer.create();
        const mongoUri = mongoServer.getUri();
        await mongoose.connect(mongoUri);
        console.log('‚úÖ Connected to database');

        // –û—á–∏—Å—Ç–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
        await Problem.deleteMany({});
        await User.deleteMany({});
        console.log('üßπ Cleared existing data');

        // –°–æ–∑–¥–∞—ë–º —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
        const problems = [
            {
                title: '–ü–µ—Ä–µ–ª–æ–º –∫–ª—é—á–∏—Ü—ã —É –≤–µ–ª–æ—Å–∏–ø–µ–¥–∏—Å—Ç–∞',
                description: '–ü–∞—Ü–∏–µ–Ω—Ç, 28 –ª–µ—Ç, —É–ø–∞–ª —Å –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞. –ñ–∞–ª–æ–±—ã –Ω–∞ –±–æ–ª—å –≤ –æ–±–ª–∞—Å—Ç–∏ –ø—Ä–∞–≤–æ–π –∫–ª—é—á–∏—Ü—ã, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏–π. –ù–∞ —Ä–µ–Ω—Ç–≥–µ–Ω–æ–≥—Ä–∞–º–º–µ –≤–∏–¥–Ω–∞ –ª–∏–Ω–∏—è –ø–µ—Ä–µ–ª–æ–º–∞ –≤ —Å—Ä–µ–¥–Ω–µ–π —Ç—Ä–µ—Ç–∏ –∫–ª—é—á–∏—Ü—ã.',
                difficulty: 'easy',
                type: 'quiz',
                options: [
                    '–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ–µ –ª–µ—á–µ–Ω–∏–µ: –ø–æ–≤—è–∑–∫–∞ –î–µ–∑–æ –Ω–∞ 3-4 –Ω–µ–¥–µ–ª–∏',
                    '–û—Ç–∫—Ä—ã—Ç–∞—è —Ä–µ–ø–æ–∑–∏—Ü–∏—è –∏ –æ—Å—Ç–µ–æ—Å–∏–Ω—Ç–µ–∑ –ø–ª–∞—Å—Ç–∏–Ω–æ–π',
                    '–°–∫–µ–ª–µ—Ç–Ω–æ–µ –≤—ã—Ç—è–∂–µ–Ω–∏–µ',
                    '–ò–º–º–æ–±–∏–ª–∏–∑–∞—Ü–∏—è –≥–∏–ø—Å–æ–≤–æ–π –ª–æ–Ω–≥–µ—Ç–æ–π'
                ],
                correctAnswer: '–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ–µ –ª–µ—á–µ–Ω–∏–µ: –ø–æ–≤—è–∑–∫–∞ –î–µ–∑–æ –Ω–∞ 3-4 –Ω–µ–¥–µ–ª–∏'
            },
            {
                title: '–ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–Ω–µ–π –∫—Ä–µ—Å—Ç–æ–æ–±—Ä–∞–∑–Ω–æ–π —Å–≤—è–∑–∫–∏',
                description: '–§—É—Ç–±–æ–ª–∏—Å—Ç, 22 –≥–æ–¥–∞, –ø–æ–ª—É—á–∏–ª —Ç—Ä–∞–≤–º—É –∫–æ–ª–µ–Ω–∞ –≤ –∏–≥—Ä–µ. –ú–µ—Ö–∞–Ω–∏–∑–º: —Ä–µ–∑–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è –Ω–∞ –æ–ø–æ—Ä–Ω–æ–π –Ω–æ–≥–µ. –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç –ø–µ—Ä–µ–¥–Ω–µ–≥–æ –≤—ã–¥–≤–∏–∂–Ω–æ–≥–æ —è—â–∏–∫–∞, –æ—Ç—ë–∫ –∫–æ–ª–µ–Ω–Ω–æ–≥–æ —Å—É—Å—Ç–∞–≤–∞. –ú–†–¢ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Ä–∞–∑—Ä—ã–≤ –ü–ö–°.',
                difficulty: 'medium',
                type: 'text',
                correctAnswer: '–ê—Ä—Ç—Ä–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∞—è —Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ü–ö–° –∞—É—Ç–æ—Ç—Ä–∞–Ω—Å–ø–ª–∞–Ω—Ç–∞—Ç–æ–º (—Å—É—Ö–æ–∂–∏–ª–∏—è –ø–æ–¥–∫–æ–ª–µ–Ω–Ω—ã—Ö –º—ã—à—Ü –∏–ª–∏ —Å–≤—è–∑–∫–∏ –Ω–∞–¥–∫–æ–ª–µ–Ω–Ω–∏–∫–∞). –†–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è 6-9 –º–µ—Å—è—Ü–µ–≤.'
            },
            {
                title: '–°—Ç—Ä–µ—Å—Å–æ–≤—ã–π –ø–µ—Ä–µ–ª–æ–º –ø–ª—é—Å–Ω–µ–≤–æ–π –∫–æ—Å—Ç–∏',
                description: '–ë–µ–≥—É–Ω –Ω–∞ –¥–ª–∏–Ω–Ω—ã–µ –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏, 30 –ª–µ—Ç, –∂–∞–ª—É–µ—Ç—Å—è –Ω–∞ –±–æ–ª—å –≤ –ø–µ—Ä–µ–¥–Ω–µ–π —á–∞—Å—Ç–∏ —Å—Ç–æ–ø—ã –ø–æ—Å–ª–µ —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã—Ö –Ω–∞–≥—Ä—É–∑–æ–∫. –ë–æ–ª–µ–∑–Ω–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–∏ –ø–∞–ª—å–ø–∞—Ü–∏–∏ II –ø–ª—é—Å–Ω–µ–≤–æ–π –∫–æ—Å—Ç–∏. –†–µ–Ω—Ç–≥–µ–Ω –±–µ–∑ —è–≤–Ω—ã—Ö –ø–µ—Ä–µ–ª–æ–º–æ–≤, –ú–†–¢ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ç—ë–∫ –∫–æ—Å—Ç–Ω–æ–≥–æ –º–æ–∑–≥–∞.',
                difficulty: 'medium',
                type: 'quiz',
                options: [
                    '–ü–æ–ª–Ω—ã–π –ø–æ–∫–æ–π 6-8 –Ω–µ–¥–µ–ª—å, –≥–∏–ø—Å',
                    '–°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–æ–∫, –æ—Ä—Ç–æ–ø–µ–¥–∏—á–µ—Å–∫–∞—è –æ–±—É–≤—å, –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º —á–µ—Ä–µ–∑ 4-6 –Ω–µ–¥–µ–ª—å',
                    '–•–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–∞—è —Ñ–∏–∫—Å–∞—Ü–∏—è –≤–∏–Ω—Ç–∞–º–∏',
                    '–§–∏–∑–∏–æ—Ç–µ—Ä–∞–ø–∏—è –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–æ–∫'
                ],
                correctAnswer: '–°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–æ–∫, –æ—Ä—Ç–æ–ø–µ–¥–∏—á–µ—Å–∫–∞—è –æ–±—É–≤—å, –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º —á–µ—Ä–µ–∑ 4-6 –Ω–µ–¥–µ–ª—å'
            },
            {
                title: '–†–∞–∑—Ä—ã–≤ –∞—Ö–∏–ª–ª–æ–≤–∞ —Å—É—Ö–æ–∂–∏–ª–∏—è',
                description: '–ë–∞—Å–∫–µ—Ç–±–æ–ª–∏—Å—Ç, 35 –ª–µ—Ç. –í–Ω–µ–∑–∞–ø–Ω–∞—è –æ—Å—Ç—Ä–∞—è –±–æ–ª—å –≤ –æ–±–ª–∞—Å—Ç–∏ –ø—è—Ç–∫–∏ –ø—Ä–∏ –ø—Ä—ã–∂–∫–µ. –ü–∞—Ü–∏–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ—â—É—â–µ–Ω–∏–µ –∫–∞–∫ "—É–¥–∞—Ä –ø–æ –Ω–æ–≥–µ". –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç –¢–æ–º–ø—Å–æ–Ω–∞, –ø–∞–ª—å–ø–∏—Ä—É–µ–º—ã–π –¥–µ—Ñ–µ–∫—Ç —Å—É—Ö–æ–∂–∏–ª–∏—è. –£–ó–ò –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Ä–∞–∑—Ä—ã–≤.',
                difficulty: 'hard',
                type: 'text',
                correctAnswer: '–•–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–æ–µ –ª–µ—á–µ–Ω–∏–µ (–æ—Ç–∫—Ä—ã—Ç—ã–π –∏–ª–∏ —á—Ä–µ—Å–∫–æ–∂–Ω—ã–π —à–æ–≤ —Å—É—Ö–æ–∂–∏–ª–∏—è) –≤ —Ç–µ—á–µ–Ω–∏–µ 48 —á–∞—Å–æ–≤. –ò–º–º–æ–±–∏–ª–∏–∑–∞—Ü–∏—è –≤ –ø–æ–ª–æ–∂–µ–Ω–∏–∏ —ç–∫–≤–∏–Ω—É—Å–∞ 6 –Ω–µ–¥–µ–ª—å —Å –ø–æ—Å–ª–µ–¥—É—é—â–µ–π —Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏–µ–π. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ–µ –ª–µ—á–µ–Ω–∏–µ (–æ—Ä—Ç–µ–∑) —Å –ø–æ–≤—ã—à–µ–Ω–Ω—ã–º —Ä–∏—Å–∫–æ–º —Ä–µ—Ü–∏–¥–∏–≤–∞.'
            },
            {
                title: '–°–æ—Ç—Ä—è—Å–µ–Ω–∏–µ –º–æ–∑–≥–∞ —É —Ö–æ–∫–∫–µ–∏—Å—Ç–∞',
                description: '–•–æ–∫–∫–µ–∏—Å—Ç, 25 –ª–µ—Ç, –ø–æ–ª—É—á–∏–ª —É–¥–∞—Ä –≤ –≥–æ–ª–æ–≤—É –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã. –ü–æ—Ç–µ—Ä—è —Å–æ–∑–Ω–∞–Ω–∏—è –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞. –ñ–∞–ª–æ–±—ã: –≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å, —Ç–æ—à–Ω–æ—Ç–∞, —Å–≤–µ—Ç–æ–±–æ—è–∑–Ω—å, –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏. –ö–¢ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–æ–∑–≥–∞ –±–µ–∑ –ø–∞—Ç–æ–ª–æ–≥–∏–∏.',
                difficulty: 'medium',
                type: 'quiz',
                options: [
                    '–í–æ–∑–≤—Ä–∞—Ç –∫ –∏–≥—Ä–µ –ø–æ—Å–ª–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è —Å–∏–º–ø—Ç–æ–º–æ–≤ (1-2 –¥–Ω—è)',
                    '–ü–æ–ª–Ω—ã–π –ø–æ–∫–æ–π 7-10 –¥–Ω–µ–π, –∑–∞—Ç–µ–º –ø–æ—ç—Ç–∞–ø–Ω–æ–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∫ –Ω–∞–≥—Ä—É–∑–∫–∞–º –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É RTP (Return to Play)',
                    '–ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –≥–æ—Å–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è –≤ –Ω–µ–π—Ä–æ—Ö–∏—Ä—É—Ä–≥–∏—é',
                    '–ú–†–¢ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–æ–∑–≥–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç –∫ –∏–≥—Ä–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –Ω–∞—Ö–æ–¥–æ–∫'
                ],
                correctAnswer: '–ü–æ–ª–Ω—ã–π –ø–æ–∫–æ–π 7-10 –¥–Ω–µ–π, –∑–∞—Ç–µ–º –ø–æ—ç—Ç–∞–ø–Ω–æ–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∫ –Ω–∞–≥—Ä—É–∑–∫–∞–º –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É RTP (Return to Play)'
            },
            {
                title: '–õ–∞—Ç–µ—Ä–∞–ª—å–Ω—ã–π —ç–ø–∏–∫–æ–Ω–¥–∏–ª–∏—Ç ("–ª–æ–∫–æ—Ç—å —Ç–µ–Ω–Ω–∏—Å–∏—Å—Ç–∞")',
                description: '–¢–µ–Ω–Ω–∏—Å–∏—Å—Ç, 32 –≥–æ–¥–∞, –∂–∞–ª—É–µ—Ç—Å—è –Ω–∞ –±–æ–ª—å –≤ –æ–±–ª–∞—Å—Ç–∏ –ª–∞—Ç–µ—Ä–∞–ª—å–Ω–æ–≥–æ –Ω–∞–¥–º—ã—â–µ–ª–∫–∞ –ø—Ä–∞–≤–æ–≥–æ –ª–æ–∫—Ç—è, —É—Å–∏–ª–∏–≤–∞—é—â—É—é—Å—è –ø—Ä–∏ —Ä–∞–∑–≥–∏–±–∞–Ω–∏–∏ –∫–∏—Å—Ç–∏ –∏ –∑–∞—Ö–≤–∞—Ç–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤. –°–∏–º–ø—Ç–æ–º—ã —Ä–∞–∑–≤–∏–≤–∞–ª–∏—Å—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –≤ —Ç–µ—á–µ–Ω–∏–µ 3 –º–µ—Å—è—Ü–µ–≤.',
                difficulty: 'easy',
                type: 'text',
                correctAnswer: '–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ–µ –ª–µ—á–µ–Ω–∏–µ: –ø–æ–∫–æ–π, –ù–ü–í–°, –∫—Ä–∏–æ—Ç–µ—Ä–∞–ø–∏—è, —ç–∫—Å—Ü–µ–Ω—Ç—Ä–∏—á–µ—Å–∫–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è, –∫–æ—Ä—Ä–µ–∫—Ü–∏—è —Ç–µ—Ö–Ω–∏–∫–∏ —É–¥–∞—Ä–∞. –ü—Ä–∏ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ - –∏–Ω—ä–µ–∫—Ü–∏–∏ PRP –∏–ª–∏ –∫–æ—Ä—Ç–∏–∫–æ—Å—Ç–µ—Ä–æ–∏–¥–æ–≤. –•–∏—Ä—É—Ä–≥–∏—è - –ø—Ä–∏ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ–≥–æ –ª–µ—á–µ–Ω–∏—è –≤ —Ç–µ—á–µ–Ω–∏–µ 6-12 –º–µ—Å—è—Ü–µ–≤.'
            },
            {
                title: '–ü–µ—Ä–µ–ª–æ–º –î–∂–æ–Ω—Å–∞ (V –ø–ª—é—Å–Ω–µ–≤–∞—è –∫–æ—Å—Ç—å)',
                description: '–§—É—Ç–±–æ–ª–∏—Å—Ç, 26 –ª–µ—Ç. –ë–æ–ª—å –≤ –æ–±–ª–∞—Å—Ç–∏ –æ—Å–Ω–æ–≤–∞–Ω–∏—è V –ø–ª—é—Å–Ω–µ–≤–æ–π –∫–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –∏–Ω–≤–µ—Ä—Å–∏–æ–Ω–Ω–æ–π —Ç—Ä–∞–≤–º—ã —Å—Ç–æ–ø—ã. –†–µ–Ω—Ç–≥–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ø–µ—Ä–µ—á–Ω—ã–π –ø–µ—Ä–µ–ª–æ–º –≤ –º–µ—Ç–∞–¥–∏–∞—Ñ–∏–∑–∞—Ä–Ω–æ–π –∑–æ–Ω–µ (–∑–æ–Ω–∞ –î–∂–æ–Ω—Å–∞).',
                difficulty: 'hard',
                type: 'quiz',
                options: [
                    '–ì–∏–ø—Å 4-6 –Ω–µ–¥–µ–ª—å, –ø–æ–ª–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞',
                    '–ò–Ω—Ç—Ä–∞–º–µ–¥—É–ª–ª—è—Ä–Ω—ã–π –≤–∏–Ω—Ç + —Ä–∞–Ω–Ω—è—è –º–æ–±–∏–ª–∏–∑–∞—Ü–∏—è (–¥–ª—è —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤)',
                    '–≠–ª–∞—Å—Ç–∏—á–Ω—ã–π –±–∏–Ω—Ç –∏ –≤–æ–∑–≤—Ä–∞—Ç –∫ –∏–≥—Ä–µ —á–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏',
                    '–§–∏–∑–∏–æ—Ç–µ—Ä–∞–ø–∏—è –±–µ–∑ –∏–º–º–æ–±–∏–ª–∏–∑–∞—Ü–∏–∏'
                ],
                correctAnswer: '–ò–Ω—Ç—Ä–∞–º–µ–¥—É–ª–ª—è—Ä–Ω—ã–π –≤–∏–Ω—Ç + —Ä–∞–Ω–Ω—è—è –º–æ–±–∏–ª–∏–∑–∞—Ü–∏—è (–¥–ª—è —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–≤)'
            }
        ];

        const createdProblems = await Problem.insertMany(problems);
        console.log(`‚úÖ Created ${createdProblems.length} problems`);

        console.log('\nüìã Sample Problems:');
        createdProblems.forEach((p, i) => {
            console.log(`${i + 1}. ${p.title} (${p.difficulty}, ${p.type})`);
        });

        console.log('\nüéâ Seed completed successfully!');
        console.log('\n‚ö†Ô∏è  IMPORTANT: This seed uses In-Memory MongoDB.');
        console.log('To add this data to your running server, copy the seed logic to a route or restart the server with seed on startup.\n');

    } catch (error) {
        console.error('‚ùå Seed error:', error);
    } finally {
        await mongoose.connection.close();
        if (mongoServer) {
            await mongoServer.stop();
        }
        process.exit();
    }
};

seedData();
